{
  "meta": {
    "product": "WeldMS",
    "startedAt": "2025-12-25T08:47:57.637Z",
    "env": "development",
    "endedAt": "2025-12-25T08:47:58.315Z",
    "durationMs": 678,
    "db": "weld-management_qa"
  },
  "created": {
    "admin": {
      "username": "arul.admin",
      "name": "Arul Admin",
      "email": "arul.admin@example.com",
      "role": "Admin",
      "avatar": null,
      "status": "active",
      "inactiveFrom": null,
      "skills": [],
      "certifications": [],
      "hourlyRate": 0,
      "paymentType": "Monthly",
      "baseSalary": 0,
      "salaryMonthly": 0,
      "salaryDaily": 0,
      "overtimeRate": 0,
      "workingDaysPerMonth": 26,
      "workingHoursPerDay": 8,
      "advanceBalance": 0,
      "employmentType": "full-time",
      "experience": 0,
      "age": null,
      "gender": "",
      "maritalStatus": "",
      "bloodGroup": "",
      "pan": "",
      "alternatePhone": "",
      "salary": {
        "baseSalary": 0,
        "paymentType": "Monthly"
      },
      "_id": "694cfa3def87a88fdd3949dc",
      "joinDate": "2025-12-25T08:47:57.924Z",
      "createdAt": "2025-12-25T08:47:57.931Z",
      "updatedAt": "2025-12-25T08:47:57.931Z",
      "employeeId": "A001"
    },
    "supervisorSimulatedAsManager": {
      "username": "kumar.supervisor",
      "name": "Kumar Supervisor",
      "email": "kumar.supervisor@example.com",
      "role": "Manager",
      "avatar": null,
      "status": "active",
      "inactiveFrom": null,
      "skills": [],
      "certifications": [],
      "hourlyRate": 0,
      "paymentType": "Monthly",
      "baseSalary": 0,
      "salaryMonthly": 0,
      "salaryDaily": 0,
      "overtimeRate": 0,
      "workingDaysPerMonth": 26,
      "workingHoursPerDay": 8,
      "advanceBalance": 0,
      "employmentType": "full-time",
      "experience": 0,
      "age": null,
      "gender": "",
      "maritalStatus": "",
      "bloodGroup": "",
      "pan": "",
      "alternatePhone": "",
      "salary": {
        "baseSalary": 0,
        "paymentType": "Monthly"
      },
      "_id": "694cfa3eef87a88fdd3949f0",
      "joinDate": "2025-12-25T08:47:58.094Z",
      "createdAt": "2025-12-25T08:47:58.095Z",
      "updatedAt": "2025-12-25T08:47:58.095Z",
      "employeeId": "M001"
    },
    "worker": null,
    "project": null,
    "tasksCreated": 0,
    "salaryInvoiceId": null
  },
  "testCases": [
    {
      "name": "Create Admin user (Arul Admin) via /api/auth/register",
      "status": "pass",
      "error": null
    },
    {
      "name": "Create Supervisor user (requested) -> uses Manager role (Kumar Supervisor)",
      "status": "pass",
      "error": null
    },
    {
      "name": "Create Worker user (Ramesh Worker) via /api/workers (Admin)",
      "status": "fail",
      "error": "Expected 201, got 400: {\"success\":false,\"message\":\"Validation failed\",\"errors\":[{\"field\":\"username\",\"message\":\"Required\"},{\"field\":\"password\",\"message\":\"Required\"}]}"
    },
    {
      "name": "Verify users exist in DB and roles are correct",
      "status": "fail",
      "error": "Worker user not found or wrong role"
    },
    {
      "name": "Permission check: Manager cannot create project (should be 403)",
      "status": "pass",
      "error": null
    },
    {
      "name": "Create Project (Factory Welding Work) as Admin",
      "status": "fail",
      "error": "Expected 201, got 400: {\"success\":false,\"message\":\"Validation failed\",\"errors\":[{\"field\":\"assignedWorkers.0\",\"message\":\"Expected string, received null\"}]}"
    },
    {
      "name": "Create Tasks across 4 weeks as Manager",
      "status": "fail",
      "error": "Cannot read properties of null (reading '_id')"
    },
    {
      "name": "Worker can only see assigned tasks",
      "status": "fail",
      "error": "Worker login failed: 401"
    },
    {
      "name": "Insert 1 month attendance (26 present, 4 absent) with overtime, linked to project (DB insert)",
      "status": "fail",
      "error": "Cannot read properties of null (reading '_id')"
    },
    {
      "name": "Salary invoice calculation uses attendance + daily wage (expect 26 × 700 = 18200)",
      "status": "fail",
      "error": "Cannot read properties of null (reading '_id')"
    },
    {
      "name": "Generate salary invoice (Admin)",
      "status": "fail",
      "error": "Cannot read properties of null (reading '_id')"
    },
    {
      "name": "Record salary payment (Admin) as partial daysPaid=26 -> 18200",
      "status": "fail",
      "error": "Cannot read properties of null (reading '_id')"
    },
    {
      "name": "Manager cannot pay salary (permission)",
      "status": "fail",
      "error": "Cannot read properties of null (reading '_id')"
    }
  ],
  "dbSnapshot": {
    "users": 2,
    "workers": 0,
    "projects": 0,
    "tasks": 0,
    "attendance": 0,
    "salaries": 0,
    "salary_payments": 0,
    "invoices": 0,
    "invoice_communications": 0
  },
  "knownGaps": [
    {
      "id": "role-supervisor-missing",
      "severity": "P0",
      "note": "Requested role \"Supervisor\" does not exist; system uses Manager. Impacts permissions + menu visibility spec."
    },
    {
      "id": "attendance-project-link-missing",
      "severity": "P0",
      "note": "Attendance API does not allow setting `project`; controller removed project assignment. Requirement says attendance auto-links worker & project."
    },
    {
      "id": "worker-soft-delete-missing",
      "severity": "P1",
      "note": "Worker delete is hard delete (no soft delete / restore). Requirement expects soft delete."
    },
    {
      "id": "salary-module-daily-wage-mismatch",
      "severity": "P0",
      "note": "Salary module generation calculates baseSalary from hours * hourlyRate; requirement wants daily wage × present days. SalaryPayment supports daysPaid, but does not update Salary records."
    },
    {
      "id": "worker-paymentType-update-gap",
      "severity": "P1",
      "note": "Worker update API allows salaryDaily but not paymentType; salary invoice calculator uses paymentType. QA script set paymentType directly in DB."
    }
  ]
}